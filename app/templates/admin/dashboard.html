<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin dashboard • Finance</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', path='css/admin.css') }}" />
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" defer></script>
    <script src="{{ url_for('static', path='js/admin-charts.js') }}" defer></script>
  </head>
  <body class="admin">
    <main class="dashboard" aria-labelledby="dashboard-heading">
      <header class="dashboard__header">
        <div>
          <p class="dashboard__eyebrow">Finance platform</p>
          <h1 id="dashboard-heading" class="dashboard__title">Admin dashboard</h1>
          <p class="dashboard__subtitle">Four quick entry points into the data.</p>
        </div>
        {% set first_date = metrics.first_transaction_at.date() if metrics.first_transaction_at else '—' %}
        {% set last_date = metrics.last_transaction_at.date() if metrics.last_transaction_at else '—' %}
        <p class="dashboard__range">Simulated data • {{ first_date }} to {{ last_date }}</p>
      </header>

      <section class="dashboard__cards" role="group" aria-label="Panels">
        <button
          type="button"
          class="dashboard__card is-active"
          data-panel-button="individuals"
          hx-get="{{ request.url_for('render_panel', panel_name='individuals') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="true"
        >
          <span class="dashboard__card-label">Individuals</span>
          <span class="dashboard__card-value">{{ '{:,}'.format(metrics.total_individuals) }}</span>
          <span class="dashboard__card-hint">People we track across the platform.</span>
        </button>
        <button
          type="button"
          class="dashboard__card"
          data-panel-button="companies"
          hx-get="{{ request.url_for('render_panel', panel_name='companies') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="dashboard__card-label">Companies</span>
          <span class="dashboard__card-value">{{ '{:,}'.format(metrics.total_companies) }}</span>
          <span class="dashboard__card-hint">Businesses on file with us.</span>
        </button>
        <button
          type="button"
          class="dashboard__card"
          data-panel-button="transactions"
          hx-get="{{ request.url_for('render_panel', panel_name='transactions') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="dashboard__card-label">Transactions</span>
          <span class="dashboard__card-value">{{ '{:,}'.format(metrics.total_transactions) }}</span>
          <span class="dashboard__card-hint">Simulated records to explore.</span>
        </button>
        <button
          type="button"
          class="dashboard__card"
          data-panel-button="stocks"
          hx-get="{{ request.url_for('render_panel', panel_name='stocks') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="dashboard__card-label">Assets under management</span>
          <span class="dashboard__card-value">{{ humanize_currency(metrics.total_aum, short=true, decimals=1) }}</span>
          <span class="dashboard__card-hint">
            {{ humanize_currency(metrics.total_cash, short=true, decimals=1) }} in cash •
            {{ humanize_currency(metrics.total_holdings, short=true, decimals=1) }} invested
          </span>
        </button>
      </section>

      {% set chart = panel_chart %}
      {% set chart_type = panel_config.chart_type %}
      {% set list_id = panel_config.list_id %}
      {% set panel_key = panel_name | default('individuals') %}
      {% set view = panel_view %}
      {% include 'admin/partials/panel.html' %}
    </main>

    <script>
      (function () {
        const setActive = (panel) => {
          document.querySelectorAll('[data-panel-button]').forEach((button) => {
            const isActive = button.dataset.panelButton === panel;
            button.classList.toggle('is-active', isActive);
            button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          });
        };

        document.addEventListener('click', (event) => {
          const button = event.target.closest('[data-panel-button]');
          if (button) {
            setActive(button.dataset.panelButton);
          }
        });

        document.body.addEventListener('htmx:afterSwap', (event) => {
          const { panel } = event.target.dataset || {};
          if (panel) {
            setActive(panel);
          }
        });
      })();
    </script>
  </body>
</html>
