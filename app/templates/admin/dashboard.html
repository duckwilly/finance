<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin dashboard â€¢ Finance</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/base.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', path='css/admin.css') }}" />
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" defer></script>
    <script src="{{ url_for('static', path='js/theme-switcher.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/admin-charts.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/list-view.js') }}" defer></script>
  </head>
  <body class="page">
    <header class="page__header">
      <div class="page__headline">
        <p class="eyebrow">Finance platform</p>
        <h1 class="page__title">Admin dashboard</h1>

      </div>
      {% set first_date = metrics.first_transaction_at.date() if metrics.first_transaction_at else 'â€”' %}
      {% set last_date = metrics.last_transaction_at.date() if metrics.last_transaction_at else 'â€”' %}
      <div class="page__meta">
        <div class="badge">Simulated data â€¢ {{ first_date }} to {{ last_date }}</div>
        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle theme">
          <span class="theme-toggle__icon">ðŸŒ™</span>
          <span class="theme-toggle__label">Dark mode</span>
        </button>
        <a class="logout-link" href="{{ request.url_for('logout') }}">Log out</a>
      </div>
    </header>

    <main class="page__content">
      <section class="card-grid" role="group" aria-label="Dashboard panels">
        <button
          type="button"
          class="card card--action is-active"
          data-panel-button="individuals"
          hx-get="{{ request.url_for('render_panel', panel_name='individuals') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="true"
        >
          <span class="card__label">Individuals</span>
          <span class="card__value">{{ '{:,}'.format(metrics.total_individuals) }}</span>
          <span class="card__hint">People we track across the platform.</span>
        </button>
        <button
          type="button"
          class="card card--action"
          data-panel-button="companies"
          hx-get="{{ request.url_for('render_panel', panel_name='companies') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="card__label">Companies</span>
          <span class="card__value">{{ '{:,}'.format(metrics.total_companies) }}</span>
          <span class="card__hint">Businesses on file with us.</span>
        </button>
        <button
          type="button"
          class="card card--action"
          data-panel-button="transactions"
          hx-get="{{ request.url_for('render_panel', panel_name='transactions') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="card__label">Transactions</span>
          <span class="card__value">{{ '{:,}'.format(metrics.total_transactions) }}</span>
          <span class="card__hint">Simulated records to explore.</span>
        </button>
        <button
          type="button"
          class="card card--action"
          data-panel-button="stocks"
          hx-get="{{ request.url_for('render_panel', panel_name='stocks') }}"
          hx-target="#dashboard-panel"
          hx-swap="outerHTML"
          aria-pressed="false"
        >
          <span class="card__label">Assets under management</span>
          <span class="card__value">{{ humanize_currency(metrics.total_aum, short=true, decimals=1) }}</span>
          <span class="card__hint">
            {{ humanize_currency(metrics.total_cash, short=true, decimals=1) }} in cash â€¢
            {{ humanize_currency(metrics.total_holdings, short=true, decimals=1) }} invested
          </span>
        </button>
      </section>

      {% set chart = panel_chart %}
      {% set chart_type = panel_config.chart_type %}
      {% set list_id = panel_config.list_id %}
      {% set panel_key = panel_name | default('individuals') %}
      {% set view = panel_view %}
      {% include 'admin/partials/panel.html' %}
    </main>

    <footer class="page__footer">
      <p>Wie dit leest is gek</p>
    </footer>

    <script>
      (function () {
        const setActive = (panel) => {
          document.querySelectorAll('[data-panel-button]').forEach((button) => {
            const isActive = button.dataset.panelButton === panel;
            button.classList.toggle('is-active', isActive);
            button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          });
        };

        document.addEventListener('click', (event) => {
          const button = event.target.closest('[data-panel-button]');
          if (button) {
            setActive(button.dataset.panelButton);
          }
        });

        document.body.addEventListener('htmx:afterSwap', (event) => {
          const { panel } = event.target.dataset || {};
          if (panel) {
            setActive(panel);
          }
        });
      })();
    </script>
  </body>
</html>
