<article class="slide" data-slide-fragment>
  <header class="slide__header">
    <h2 class="slide__title">Database platform</h2>
  </header>
  <div class="slide__content slide__grid">
    <div class="slide__content">
      <div>
        <h3 class="slide__section-title">Seed data</h3>
        <p>Synthetic user data is generated as CSV with a Python script, and real market data is pulled from Yahoo Finance:</p>
        <pre class="slide__code"><code class="language-bash"># Generate seed data
python scripts/gen_seed_data.py

# Load data into the database
python scripts/load_csvs.py</code></pre>
        <pre class="slide__code"><code class="language-bash">data/seed/
  |-- parties.csv
  |-- accounts.csv
  |-- journal_entries.csv
  \-- holdings.csv</code></pre>
      </div>

      <div>
        <h3 class="slide__section-title">MariaDB on Docker</h3>
        <p>The database runs inside a Docker container:</p>
        <pre class="slide__code"><code class="language-yaml">services:
  db:
    image: mariadb:11
    container_name: finance-mariadb
    environment:
      MARIADB_DATABASE: finance
      MARIADB_USER: app
      MARIADB_PASSWORD: apppwd
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql</code></pre>
      </div>
    </div>

    <div class="slide__content">
      <div>
        <h3 class="slide__section-title">Schema</h3>
        <p>The database schema is defined in SQL:</p>
        <pre class="slide__code"><code class="language-sql">-- sql/schema.sql
CREATE TABLE parties (
    id INT PRIMARY KEY AUTO_INCREMENT,
    party_type VARCHAR(20) NOT NULL,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE accounts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    party_id INT,
    FOREIGN KEY (party_id) REFERENCES parties(id)
);</code></pre>
      </div>

      <div>
        <h3 class="slide__section-title">Database connection</h3>
        <p>SQLAlchemy connects to the database:</p>
        <pre class="slide__code"><code class="language-python">def create_engine_from_settings():
    settings = get_settings()
    return create_engine(
        f"mysql+pymysql://{settings.database.user}:"
        f"{settings.database.password}@"
        f"{settings.database.host}:"
        f"{settings.database.port}/"
        f"{settings.database.name}"
    )</code></pre>
        <p>The connection string is built from the .env file:</p>
        <pre class="slide__code"><code class="language-bash">DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=finance
DB_USER=app
DB_PASSWORD=apppwd</code></pre>
      </div>
    </div>
  </div>
</article>
